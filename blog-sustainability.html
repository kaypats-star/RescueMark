<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="with=device-width, initial-scale=1.0">
    <title>Reducing Food Waste at Home | RescueMark Blog</title>
    <link rel="stylesheet" href="style-darkgold.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <section class="subheader">
        <nav>
            <a href="index.html"><img src="images/goldlogo.png"></a>
            <div class="nav-links" id="navLinks">
                <i class="fa fa-times" onclick="hideMenu()"></i>
                <ul>
                    <li><a href="index.html">HOME</a></li>
                    <li><a href="about the app.html">THE APP</a></li>
                    <li class="active"><a href="blogRM.html">BLOG</a></li>
                    <li><a href="contactRM.html">CONTACT</a></li>
                    <li><a href="donateRM.html">DONATE</a></li>
                    <li><a href="FAQs.html">FAQS</a></li>
                </ul>
            </div>
            <i class="fa fa-bars" onclick="showMenu()"></i>
        </nav>
        <h1>Reducing Food Waste at Home</h1>
    </section>

    <section class="blog">
        <div class="row">
            <div class="blog-left">
                <img src="images/sustainability2.jpg" alt="Reducing Food Waste">
                <p><small>Posted on November 5, 2024</small></p>
                
                <h2>Simple Steps to Minimize Waste and Save Money</h2>
                <p>Every year, South African households throw away millions of tons of perfectly good food. Here's how you can do your part to reduce waste while saving money.</p>

                <h3>Smart Storage Solutions</h3>
                <p>Learn how to store different foods properly. Keep potatoes and onions in cool, dark places (but not together!). Store herbs in jars of water like flowers. Freeze bread and other baked goods to extend their life.</p>

                <h3>The "First In, First Out" Rule</h3>
                <p>When unpacking groceries, move older items to the front and place new items behind them. This ensures you use food before it expires.</p>

                <h3>Creative Leftover Ideas</h3>
                <p>Turn leftover rice into fried rice or rice pudding. Stale bread becomes croutons or breadcrumbs. Overripe bananas are perfect for banana bread or smoothies.</h3>

                <h3>Portion Control</h3>
                <p>Cook only what you'll eat, or plan to repurpose leftovers. Use smaller plates to avoid over-serving, and remember you can always have seconds if you're still hungry.</p>

                <h3>How RescueMark Helps</h3>
                <p>Our platform connects you with local stores offering discounts on near-expiry items. You save money while preventing perfectly good food from going to waste. It's sustainability made simple!</p>

                <div class="comment-box">
                    <h3>Share Your Waste-Reduction Tips!</h3>
                    <form class="comment-form" id="commentForm">
                        <input type="text" name="commentName" placeholder="Enter Name" required>
                        <input type="email" name="commentEmail" placeholder="Email" required>
                        <textarea name="commentText" rows="5" placeholder="Your tips for reducing food waste..." required></textarea>
                        <button type="submit" class="hero-btn green-btn">POST COMMENT</button>
                    </form>

                    <div class="comments-display" id="commentsDisplay">
                        <div class="loading-comments">Loading comments...</div>
                    </div>
                </div>
            </div>

            <div class="blog-right">
                <h3>More Blog Posts</h3>
                <div class="recent-posts">
                    <a href="blogRM.html" class="post-preview">
                        <h4>Recipes Using Near-Expiry Ingredients</h4>
                        <p>Turn soon-to-expire food into delicious meals...</p>
                        <small>Read More →</small>
                    </a>
                    
                    <a href="blog-easy-recipes.html" class="post-preview">
                        <h4>5-Minute Meals for Busy Weeknights</h4>
                        <p>Quick and delicious recipes when you're short on time...</p>
                        <small>Read More →</small>
                    </a>
                    
                    <a href="blog-budget-tips.html" class="post-preview">
                        <h4>Meal Planning on a Budget</h4>
                        <p>How to stretch your grocery budget while eating well...</p>
                        <small>Read More →</small>
                    </a>
                    
                    <a href="blog-food-facts.html" class="post-preview">
                        <h4>Food Safety Myths Debunked</h4>
                        <p>Separating fact from fiction in food safety...</p>
                        <small>Read More →</small>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Add your modal and footer here -->
    <div id="confirm-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <p>Are you sure you want to delete this comment?</p>
            <div class="modal-buttons">
                <button id="confirm-yes" class="hero-btn green-btn">Yes, Delete</button>
                <button id="confirm-no" class="hero-btn" style="background:#fff;border:2px solid #D4AF37;color:#b8932e;">Cancel</button>
            </div>
        </div>
    </div>

    <section class="footer">
        <h4>About Us</h4>
        <p>RescueMark is a Gauteng-based platform helping reduce food waste by connecting people with affordable, surplus food. 
            <br>We support local businesses while making everyday essentials more accessible.
            <br>Together, we're building a more sustainable and food-secure future.</p>
        <div class="icons">
            <i class="fa-brands fa-instagram"></i>
            <i class="fa-brands fa-tiktok"></i>
            <i class="fa-brands fa-linkedin-in"></i>
            <i class="fa-brands fa-whatsapp"></i>
        </div>
        <p>Made with <i class="fa-regular fa-heart"></i> by Analytic Aces</p>
    </section>

    <!-- Back to Top Button -->
    <button id="backToTop" class="back-to-top" aria-label="Back to top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- JavaScript -->
    <script src="script.js"></script>
    
    <!-- Firebase Comments for this specific post -->
    <script type="module">
      // Same Firebase comments code as blogRM.html but with different postId
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, orderBy, query, serverTimestamp, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAqrzl1t9Ltsg5svDyWaTV7yKnFvHfMM8o",
        authDomain: "rescuemark-blog-comments.firebaseapp.com",
        projectId: "rescuemark-blog-comments",
        storageBucket: "rescuemark-blog-comments.firebasestorage.app",
        messagingSenderId: "522498051085",
        appId: "1:522498051085:web:a6b1ec8e76098d130f9944"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      
      // Each post has unique comments by using the page name as postId
      const currentPostId = 'sustainability-reduce-waste';

      emailjs.init("QPhdOZQufzjykyAq8");

  function getUserId() {
    let userId = localStorage.getItem('rm_user_id');
    if (!userId) {
      userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      localStorage.setItem('rm_user_id', userId);
    }
    return userId;
  }

  const currentUserId = getUserId();

  document.addEventListener('DOMContentLoaded', function() {
    const commentForm = document.getElementById('commentForm');
    const commentsDisplay = document.getElementById('commentsDisplay');
    const modal = document.getElementById('confirm-modal');
    const confirmYes = document.getElementById('confirm-yes');
    const confirmNo = document.getElementById('confirm-no');
    
    let commentToDelete = null;

    // Load comments function
    const loadComments = () => {
      const q = query(collection(db, "comments"), orderBy("timestamp", "desc"));
      
      onSnapshot(q, (snapshot) => {
        commentsDisplay.innerHTML = '';
        
        if (snapshot.empty) {
          commentsDisplay.innerHTML = '<p>No comments yet. Be the first to comment!</p>';
          return;
        }
        
        snapshot.forEach((doc) => {
          const comment = doc.data();
          const isMyComment = comment.userId === currentUserId;
          
          const commentEl = document.createElement('div');
          commentEl.className = 'single-comment';
          commentEl.id = 'comment-' + doc.id;
          commentEl.innerHTML = `
            <h4>${escapeHtml(comment.name)}</h4>
            <p>${escapeHtml(comment.text)}</p>
            <small>${comment.timestamp ? new Date(comment.timestamp.toDate()).toLocaleString() : 'Recently'}</small>
            ${isMyComment ? '<button class="delete-comment" data-doc-id="' + doc.id + '">Delete</button>' : ''}
          `;
          
          commentsDisplay.appendChild(commentEl);

          if (isMyComment) {
            const deleteBtn = commentEl.querySelector('.delete-comment');
            deleteBtn.addEventListener('click', function() {
              commentToDelete = this.getAttribute('data-doc-id');
              modal.style.display = 'flex';
            });
          }
        });
        
        scrollToComment();
      }, (error) => {
        console.error('Error loading comments:', error);
        commentsDisplay.innerHTML = '<p>Error loading comments. Please refresh.</p>';
      });
    };

    function scrollToComment() {
      const hash = window.location.hash;
      if (hash && hash.startsWith('#comment-')) {
        const commentElement = document.querySelector(hash);
        if (commentElement) {
          setTimeout(() => {
            commentElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            commentElement.style.backgroundColor = '#fff8e1';
            commentElement.style.transition = 'background-color 0.5s ease';
            setTimeout(() => {
              commentElement.style.backgroundColor = '';
            }, 3000);
          }, 500);
        }
      }
    }

    // UPDATED: Submit comment with email notification
    commentForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = commentForm.commentName.value.trim();
      const email = commentForm.commentEmail.value.trim();
      const text = commentForm.commentText.value.trim();
      
      if (!name || !email || !text) {
        alert('Please fill in all fields.');
        return;
      }
      
      const submitBtn = commentForm.querySelector('button');
      const originalText = submitBtn.textContent;
      
      try {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Posting...';
        
        // Add comment to Firestore
        const docRef = await addDoc(collection(db, "comments"), {
          name: name,
          email: email,
          text: text,
          userId: currentUserId,
          timestamp: serverTimestamp()
        });
        
        const commentId = docRef.id;
        const commentLink = `${window.location.origin}${window.location.pathname}#comment-${commentId}`;
        
        console.log('📝 Comment posted with ID:', commentId);
        console.log('🔗 Comment link:', commentLink);
        
        // UPDATED: Send email notification with DEBUGGING
        console.log('📧 Attempting to send email...');
        console.log('EmailJS Config:', {
          serviceId: 'service_qn9px3t',
          templateId: 'template_zvz8l5j',
          publicKey: 'QPhdOZQufzjykyAq8'
        });
        
        try {
          const emailResult = await emailjs.send('service_qn9px3t', 'template_zvz8l5j', {
            to_name: name,
            to_email: email,
            comment_text: text,
            comment_link: commentLink,
            website_name: 'RescueMark Blog',
            post_title: 'Quick, Tasty & Waste-Free Meals'
          });
          
          console.log('✅ Email sent successfully!', emailResult);
          console.log('Status:', emailResult.status);
          console.log('Text:', emailResult.text);
          
        } catch (emailError) {
          console.error('❌ EmailJS Error:', emailError);
          console.log('Error status:', emailError.status);
          console.log('Error text:', emailError.text);
          // Don't show alert for email failure - comment still posted
        }
        
        commentForm.reset();
        alert('✅ Comment posted successfully! Check your email for a confirmation with your comment link.');
        
      } catch (error) {
        console.error('❌ Error posting comment:', error);
        alert('❌ Error posting comment: ' + error.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });

    // Modal handlers
    confirmYes.addEventListener('click', async () => {
      if (commentToDelete) {
        try {
          await deleteDoc(doc(db, "comments", commentToDelete));
          console.log('🗑️ Comment deleted');
          modal.style.display = 'none';
          commentToDelete = null;
          alert('Comment deleted successfully!');
        } catch (error) {
          console.error('Delete error:', error);
          alert('❌ Error deleting comment: ' + error.message);
        }
      }
    });

    confirmNo.addEventListener('click', () => {
      modal.style.display = 'none';
      commentToDelete = null;
    });

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
        commentToDelete = null;
      }
    });

    // Load comments on page load
    loadComments();
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  });
</script>

<script src="https://cdn.botpress.cloud/webchat/v3.2/inject.js" defer></script>
<script src="https://files.bpcontent.cloud/2025/07/29/13/20250729133757-HL6WZY3E.js" defer></script>

</body>
</html>