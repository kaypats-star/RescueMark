<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="with=device-width, initial-scale=1.0">
        <title> Blog | RescueMark</title>
        <link rel="stylesheet" href="style-darkgold.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <section class="subheader">
        <nav>
            <a href="index.html"><img src="images/RMNewLogoNoBg.png"></a>
            <div class="nav-links" id="navLinks">
                <i class="fa fa-times" onclick="hideMenu()"></i>
                <ul>
                    <li><a href="index.html">HOME</a></li>
                    <!-- <li><a href="aboutRM.html">ABOUT</a></li> -->
                    <li><a href="about the app.html">THE APP</a></li>
                    <!-- <li><a href="team page.html">MEET THE TEAM</a></li> -->
                    <li class="active"><a href="blogRM.html">BLOG</a>
                    <li><a href="contactRM.html">CONTACT</a></li>
                    <li><a href="donateRM.html">DONATE</a></li>
                    <li><a href="FAQs.html">FAQS</a></li>
                </ul>
            </div>
            <i class="fa fa-bars" onclick="showMenu()"></i>
        </nav>
        <h1>Quick, Tasty & Waste-Free Meals</h1>
    </section>
<!-- ------ blog page content---------- -->
   <section class="blog">
        <div class="row">
            <div class="blog-left">
                <img src="images/foodbowl1.jpg" alt="Food Bowl">
                <h2>Recipes Using Near-Expiry Ingredients</h2>
                <p>Just because something is close to its expiry date doesn’t mean it can’t be turned into something delicious! 
                    In fact, near-expiry ingredients are perfect for quick meals that save you money and reduce food waste — 
                    a win for your wallet and the planet.
                    Here are a few simple, tasty recipes you can whip up using common near-expiry items:</p>
                <br>
                <h5>Rescue Stir-Fry</h5>
                <p>Great for: Almost-expired veggies, leftover rice, sauce packets<br>
                    How to make it: Chop up any wilting veggies (think peppers, carrots, spinach, etc.) and toss them in a hot pan with oil,
                    garlic, and soy sauce. Add in your leftover rice or noodles and stir everything together. 
                    Finish with a sprinkle of sesame seeds or chili flakes for extra flavor.</p>
                <br>
                <h5>Bread Saver French Toast</h5>
                <p>Great for: Bread that’s going stale, milk, eggs<br>
                    How to make it: Whisk together eggs, milk, a dash of cinnamon, and vanilla. 
                    Dip slices of slightly stale bread in the mix, then pan-fry until golden. Serve with fruit or a drizzle of syrup.</p>
                <br>
                <h5>Fruit Rescue Smoothie</h5>
                <p>Great for: Overripe bananas, soft berries, yogurt<br>
                    How to make it: Blend any soft fruits with a spoon of yogurt and a splash of milk or juice. 
                    Add honey or peanut butter if you like it sweeter. Perfect for breakfast or a snack!</p>
                <br>
                <p>At RescueMark, we believe that good food deserves a second chance. These recipes prove that with a little creativity, 
                    near-expiry food can become your next favourite meal.
                    Got your own food-saving recipe? Share it with us — we’d love to feature it in our next blog post!</p>

<div class="comment-box">
    <form class="comment-form" id="commentForm">
        <input type="text" name="commentName" placeholder="Enter Name" required>
        <input type="email" name="commentEmail" placeholder="Email" required>
        <textarea name="commentText" rows="5" placeholder="Your Comment" required></textarea>
        <button type="submit" class="hero-btn green-btn">POST COMMENT</button>
    </form>

    <div class="comments-display" id="commentsDisplay">
        <div class="loading-comments">Loading comments...</div>
    </div>
</div>

<!-- Simple Modal (add this if not exists) -->
<div id="confirm-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <p>Are you sure you want to delete this comment?</p>
        <div class="modal-buttons">
            <button id="confirm-yes" class="hero-btn green-btn">Yes, Delete</button>
            <button id="confirm-no" class="hero-btn" style="background:#fff;border:2px solid #D4AF37;color:#b8932e;">Cancel</button>
        </div>
    </div>
</div>

            <div class="blog-right">
                <h3>Post Categories</h3>
                <div class="category-buttons">
                    <a href="#" class="category-btn">Easy Recipes (21)</a>
                    <a href="#" class="category-btn">Budget Tips (15)</a>
                    <a href="#" class="category-btn">Food Facts (23)</a>
                    <a href="#" class="category-btn">Sustainability (9)</a>
                    <a href="#" class="category-btn">Community Stories (24)</a>
                    <a href="#" class="category-btn">Behind the Scenes (13)</a>
                    <a href="#" class="category-btn">Seasonal Picks (19)</a>
                    <a href="#" class="category-btn">Smart Shopping (8)</a>
                </div>
            </div>
        </div>
    </section>
<!-- ------- Footer ------- -->
  <section class="footer">
    <h4>About Us</h4>
    <p>RescueMark is a Gauteng-based platform helping reduce food waste by connecting people with affordable, surplus food. 
        <br>We support local businesses while making everyday essentials more accessible.
        <br>Together, we’re building a more sustainable and food-secure future.</p>
        <div class="icons">
            <i class="fa-brands fa-instagram"></i>
            <i class="fa-brands fa-tiktok"></i>
            <i class="fa-brands fa-linkedin-in"></i>
            <i class="fa-brands fa-whatsapp"></i>
        </div>
        <p>Made with <i class="fa-regular fa-heart"></i> by Analytic Aces</p>
  </section>

<!-- Back to Top Button -->
<button id="backToTop" class="back-to-top" aria-label="Back to top">
    <i class="fas fa-chevron-up"></i>
</button>

<!-- -----JavaScript ------ -->
<script src="/script.js"></script>

<!-- Add EmailJS SDK -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, orderBy, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAqrzl1t9Ltsg5svDyWaTV7yKnFvHfMM8o",
    authDomain: "rescuemark-blog-comments.firebaseapp.com",
    projectId: "rescuemark-blog-comments",
    storageBucket: "rescuemark-blog-comments.firebasestorage.app",
    messagingSenderId: "522498051085",
    appId: "1:522498051085:web:a6b1ec8e76098d130f9944"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Initialize EmailJS with YOUR credentials
  emailjs.init("QPhdOZQufzjykyAq8");

  function getUserId() {
    let userId = localStorage.getItem('rm_user_id');
    if (!userId) {
      userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      localStorage.setItem('rm_user_id', userId);
    }
    return userId;
  }

  const currentUserId = getUserId();

  document.addEventListener('DOMContentLoaded', function() {
    const commentForm = document.getElementById('commentForm');
    const commentsDisplay = document.getElementById('commentsDisplay');
    const modal = document.getElementById('confirm-modal');
    const confirmYes = document.getElementById('confirm-yes');
    const confirmNo = document.getElementById('confirm-no');
    
    let commentToDelete = null;

    // Load comments function
    const loadComments = () => {
      const q = query(collection(db, "comments"), orderBy("timestamp", "desc"));
      
      onSnapshot(q, (snapshot) => {
        commentsDisplay.innerHTML = '';
        
        if (snapshot.empty) {
          commentsDisplay.innerHTML = '<p>No comments yet. Be the first to comment!</p>';
          return;
        }
        
        snapshot.forEach((doc) => {
          const comment = doc.data();
          const isMyComment = comment.userId === currentUserId;
          
          const commentEl = document.createElement('div');
          commentEl.className = 'single-comment';
          commentEl.id = 'comment-' + doc.id; // Add ID for direct linking
          commentEl.innerHTML = `
            <h4>${escapeHtml(comment.name)}</h4>
            <p>${escapeHtml(comment.text)}</p>
            <small>${comment.timestamp ? new Date(comment.timestamp.toDate()).toLocaleString() : 'Recently'}</small>
            ${isMyComment ? '<button class="delete-comment" data-doc-id="' + doc.id + '">Delete</button>' : ''}
          `;
          
          commentsDisplay.appendChild(commentEl);

          if (isMyComment) {
            const deleteBtn = commentEl.querySelector('.delete-comment');
            deleteBtn.addEventListener('click', function() {
              commentToDelete = this.getAttribute('data-doc-id');
              modal.style.display = 'flex';
            });
          }
        });
        
        // Scroll to comment if URL has anchor
        scrollToComment();
      }, (error) => {
        console.error('Error loading comments:', error);
        commentsDisplay.innerHTML = '<p>Error loading comments. Please refresh.</p>';
      });
    };

    // Smooth scroll to comment when URL has anchor
    function scrollToComment() {
      const hash = window.location.hash;
      if (hash && hash.startsWith('#comment-')) {
        const commentElement = document.querySelector(hash);
        if (commentElement) {
          setTimeout(() => {
            commentElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            commentElement.style.backgroundColor = '#fff8e1';
            commentElement.style.transition = 'background-color 0.5s ease';
            setTimeout(() => {
              commentElement.style.backgroundColor = '';
            }, 3000);
          }, 500);
        }
      }
    }

    // Submit comment with email notification
    commentForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = commentForm.commentName.value.trim();
      const email = commentForm.commentEmail.value.trim();
      const text = commentForm.commentText.value.trim();
      
      if (!name || !email || !text) {
        alert('Please fill in all fields.');
        return;
      }
      
      const submitBtn = commentForm.querySelector('button');
      const originalText = submitBtn.textContent;
      
      try {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Posting...';
        
        // Add comment to Firestore
        const docRef = await addDoc(collection(db, "comments"), {
          name: name,
          email: email,
          text: text,
          userId: currentUserId,
          timestamp: serverTimestamp()
        });
        
        const commentId = docRef.id;
        const commentLink = `${window.location.origin}${window.location.pathname}#comment-${commentId}`;
        
        console.log('Comment posted with ID:', commentId);
        console.log('Comment link:', commentLink);
        
        // Send email notification
        try {
          await emailjs.send('service_qn9px3t', 'template_pyyfb87', {
            to_name: name,
            to_email: email,
            comment_text: text,
            comment_link: commentLink,
            website_name: 'RescueMark Blog',
            post_title: 'Quick, Tasty & Waste-Free Meals'
          });
          
          console.log('Email sent successfully');
          
        } catch (emailError) {
          console.warn('Email failed to send, but comment was posted:', emailError);
          // Don't alert user about email failure - comment still worked
        }
        
        commentForm.reset();
        alert('✅ Comment posted successfully! Check your email for a confirmation with your comment link.');
        
      } catch (error) {
        console.error('Error posting comment:', error);
        alert('❌ Error posting comment: ' + error.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });

    // Modal handlers
    confirmYes.addEventListener('click', async () => {
      if (commentToDelete) {
        try {
          await deleteDoc(doc(db, "comments", commentToDelete));
          console.log('Comment deleted');
          modal.style.display = 'none';
          commentToDelete = null;
          alert('Comment deleted successfully!');
        } catch (error) {
          console.error('Delete error:', error);
          alert('❌ Error deleting comment: ' + error.message);
        }
      }
    });

    confirmNo.addEventListener('click', () => {
      modal.style.display = 'none';
      commentToDelete = null;
    });

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
        commentToDelete = null;
      }
    });

    // Load comments on page load
    loadComments();
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  });
</script>

<script src="https://cdn.botpress.cloud/webchat/v3.2/inject.js" defer></script>
<script src="https://files.bpcontent.cloud/2025/07/29/13/20250729133757-HL6WZY3E.js" defer></script>
</body>
</html>